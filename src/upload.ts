const imagesData = [
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "100",
    "DESCRIPTION PHOTO": "Couverture",
    QUALITE: "false",
    ISCOVER: "true",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "101",
    "DESCRIPTION PHOTO": "Sans titre",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "102",
    "DESCRIPTION PHOTO": "Sans titre",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "103",
    "DESCRIPTION PHOTO": "Corot",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "104",
    "DESCRIPTION PHOTO": "Diaz",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "105",
    "DESCRIPTION PHOTO": "Sans titre",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "106",
    "DESCRIPTION PHOTO": "Ségé 1869",
    "MOTS CLES": "Copie",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "107",
    "DESCRIPTION PHOTO": "Beaucé 1869",
    "MOTS CLES": "Copie",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "108",
    "DESCRIPTION PHOTO": "Durand Brager 1869",
    "MOTS CLES": "Copie",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "109",
    "DESCRIPTION PHOTO": "Brion 1869",
    "MOTS CLES": "Copie",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "110",
    "DESCRIPTION PHOTO": "Mazure 1869",
    "MOTS CLES": "Copie",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "111",
    "DESCRIPTION PHOTO": "Harpigures 1869",
    "MOTS CLES": "Copie",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "2",
    CARNET: "D",
    DATE: "1869-1870",
    "TITRE CARNET": "SALON-BEUZEVAL-LIEGE-DINARD",
    PHOTO: "112",
    "DESCRIPTION PHOTO": "Sans titre 1869",
    "MOTS CLES": "Copie",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "100",
    "DESCRIPTION PHOTO": "Couverture",
    QUALITE: "false",
    ISCOVER: "true",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "101",
    "DESCRIPTION PHOTO": "Le Tréport",
    "MOTS CLES": "Plage",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "102",
    "DESCRIPTION PHOTO": "Près d'Eu",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "104",
    "DESCRIPTION PHOTO": "Le Bourg d'Ault",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "105",
    "DESCRIPTION PHOTO": "Prise d'un aigle",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "108",
    "DESCRIPTION PHOTO": "Phare de Caieux",
    "MOTS CLES": "Plage",
    QUALITE: "true",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "109",
    "DESCRIPTION PHOTO": "Caieux",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "110",
    "DESCRIPTION PHOTO": "Caieux",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "111",
    "DESCRIPTION PHOTO": "St Valery/Somme",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "1",
    CARNET: "E",
    DATE: "1874-1876",
    "TITRE CARNET": "TREPORT BRETAGNE CONCARNEAU",
    PHOTO: "112",
    "DESCRIPTION PHOTO": "Le Crotoy",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U101",
    "DESCRIPTION PHOTO": "Couverture",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "true",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U102",
    "DESCRIPTION PHOTO": "Carabiniers",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U103",
    "DESCRIPTION PHOTO": "Sans titre de Louis XIV a 1842",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U104",
    "DESCRIPTION PHOTO": "Grenadiers",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U105",
    "DESCRIPTION PHOTO": "Artillerie",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U106",
    "DESCRIPTION PHOTO": "Tambours",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U107",
    "DESCRIPTION PHOTO": "Dragons",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U108",
    "DESCRIPTION PHOTO": "Lanciers",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U109",
    "DESCRIPTION PHOTO": "Hussards",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
  {
    Number: "3",
    CARNET: "U",
    DATE: "NO DATE",
    "TITRE CARNET": "INFANTERIE MILITAIRE",
    PHOTO: "U110",
    "DESCRIPTION PHOTO": "Chasseurs a Cheval",
    "MOTS CLES": "Militaire",
    QUALITE: "false",
    ISCOVER: "false",
  },
];

const upload = async () => {
  const fs = require("fs");
  const cloudinary = require("cloudinary").v2;

  cloudinary.config({
    api_secret: "",
    cloud_name: "",
    api_key: "",
  });
  const albumRoot =
    "C:/Users/Utilisateur/Documents/dev/giraud-gallery/album/albums";
  const albums = await fs.promises.readdir(albumRoot);
  const cloudRootName = "giraud-images";

  const database = {};
  let imageCounter = 0;
  for (let i = 0; i < albums.length; i++) {
    const albumId = albums[i];
    const firstAlbumImage = imagesData.find((p) => p.CARNET === albumId);
    console.log("looking album", albumId);
    const albumPictures = [];

    try {
      const files = await fs.promises.readdir(`${albumRoot}/${albumId}`);
      for (const file of files) {
        const currentImage = imagesData[imageCounter];
        console.log(
          "uploading",
          `${cloudRootName}/${albumId}/${file}`,
          imagesData[imageCounter].PHOTO
        );

        const publicId = `${cloudRootName}/${albumId}/${file}`;

        const result = await cloudinary.uploader.upload(
          `${albumRoot}/${albumId}/${file}`,
          {
            public_id: publicId,
          }
        );

        const picture = {
          description:
            currentImage["DESCRIPTION PHOTO"] &&
            currentImage["DESCRIPTION PHOTO"],
          tags:
            currentImage["MOTS CLES"] &&
            currentImage["MOTS CLES"].split(",").map((t) => t.trim()),
          isQuality: currentImage.QUALITE === "true" ? true : false,
          isCover: currentImage.ISCOVER === "true" ? true : false,
          cloudinaryPublicId: result.public_id,
          cloudinaryId: result.asset_id,
          width: result.width,
          height: result.height,
        };
        albumPictures.push(picture);
        imageCounter++;
      }
    } catch (e) {
      console.error("We've thrown! Whoops!", e);
    }
    database[albumId] = {
      pictures: albumPictures,
      name: firstAlbumImage["TITRE CARNET"],
      date: firstAlbumImage.DATE,
      id: albumId,
      number: parseInt(firstAlbumImage.Number),
    };
  }
  fs.writeFileSync(
    `initialDatabase.ts`,
    `export const initialDatabase = ${JSON.stringify(database)}`,
    "utf8"
  );
};

upload();
